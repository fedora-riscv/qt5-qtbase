diff -up qtbase-opensource-src-5.9.6/src/plugins/sqldrivers/mysql/qsql_mysql.cpp.mariadb qtbase-opensource-src-5.9.6/src/plugins/sqldrivers/mysql/qsql_mysql.cpp
--- qtbase-opensource-src-5.9.6/src/plugins/sqldrivers/mysql/qsql_mysql.cpp.mariadb	2018-06-11 10:03:46.720013031 -0500
+++ qtbase-opensource-src-5.9.6/src/plugins/sqldrivers/mysql/qsql_mysql.cpp	2018-06-11 10:13:52.285354880 -0500
@@ -1159,14 +1159,14 @@ static void qLibraryInit()
 # endif // MYSQL_VERSION_ID
 #endif // Q_NO_MYSQL_EMBEDDED
 
-#ifdef MARIADB_BASE_VERSION
+#if defined(MARIADB_BASE_VERSION) || defined(MARIADB_VERSION_ID)
     qAddPostRoutine([]() { mysql_server_end(); });
 #endif
 }
 
 static void qLibraryEnd()
 {
-#if !defined(MARIADB_BASE_VERSION)
+#if !defined(MARIADB_BASE_VERSION) && !defined(MARIADB_VERSION_ID)
 # if !defined(Q_NO_MYSQL_EMBEDDED)
 #  if MYSQL_VERSION_ID > 40000
 #   if (MYSQL_VERSION_ID >= 40110 && MYSQL_VERSION_ID < 50000) || MYSQL_VERSION_ID >= 50003
