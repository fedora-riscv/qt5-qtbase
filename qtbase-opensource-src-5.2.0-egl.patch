From 20272ad6e5c56db87146f85f98c560099bfdbb75 Mon Sep 17 00:00:00 2001
From: Jorgen Lind <jorgen.lind@digia.com>
Date: Tue, 12 Nov 2013 09:25:23 +0100
Subject: [PATCH] Fix configure script to not dictate OpenGL ES 2 when EGL is
 enabled

Change-Id: I4d940ef436f21fd915f3d03558fd4fb4c7b3e5b7
Reviewed-by: Gunnar Sletta <gunnar.sletta@digia.com>
---
 configure | 34 +++++++---------------------------
 1 file changed, 7 insertions(+), 27 deletions(-)

diff --git a/configure b/configure
index 81e2a93..5ff8ad1 100755
--- a/configure
+++ b/configure
@@ -3679,7 +3679,7 @@ Additional options:
  $XCBY  -xcb ............... Compile Xcb support.
 
  $EGLFSN  -no-eglfs .......... Do not compile EGLFS (EGL Full Screen/Single Surface) support.
- $EGLFSY  -eglfs ............. Compile EGLFS support (Requires OpenGL ES 2 support).
+ $EGLFSY  -eglfs ............. Compile EGLFS support.
 
  $DFBN  -no-directfb ....... Do not compile DirectFB support.
  $DFBY  -directfb .......... Compile DirectFB support.
@@ -3688,7 +3688,7 @@ Additional options:
  $LFBY  -linuxfb ........... Compile Linux Framebuffer support.
 
  $KMSN  -no-kms ............ Do not compile KMS support.
- $KMSY  -kms ............... Compile KMS support (Requires EGL and OpenGL ES 2 support).
+ $KMSY  -kms ............... Compile KMS support (Requires EGL).
 
     -qpa <name> ......... Sets the default QPA platform (e.g xcb, cocoa, windows).
 
@@ -4638,11 +4638,6 @@ if [ "$CFG_EGLFS" = "yes" ]; then
         echo "The EGLFS plugin requires EGL support and cannot be built"
         exit 101
     fi
-    if [ "$CFG_OPENGL" != "es2" ]; then
-        echo "The EGLFS plugin requires OpenGL ES 2 support and cannot be built"
-        exit 101
-    fi
-    CFG_OPENGL="es2"
     CFG_EGL=yes
 fi
 
@@ -4651,10 +4646,6 @@ if [ "$CFG_KMS" = "yes" ]; then
         echo "The KMS plugin requires EGL support and cannot be built"
         exit 101
     fi
-    if [ "$CFG_OPENGL" != "es2" ]; then
-        echo "The KMS plugin requires OpenGL ES 2 support and cannot be built"
-        exit 101
-    fi
 fi
 
 # auto-detect SQL-modules support
@@ -5490,17 +5481,10 @@ elif [ "$CFG_XKBCOMMON" = "no" ]; then
 fi
 
 # EGL Support
-if [ "$CFG_OPENGL" != "es2" ]; then
-    if [ "$CFG_EGL" = "yes" ] && [ "$CFG_OPENGL" = "desktop" ]; then
-        echo "EGL support was requested but Qt is being configured for desktop OpenGL."
-        echo "Either disable EGL support or enable OpenGL ES support."
-        exit 101
-    elif [ "$CFG_EGL" = "yes" ] && [ "$CFG_OPENGL" = "no" ]; then
-        echo "EGL support was requested but OpenGL ES support is disabled."
+if [ "$CFG_EGL" = "yes" ] && [ "$CFG_OPENGL" = "no" ]; then
+        echo "EGL support was requested but OpenGL support is disabled."
         echo "Either disable EGL support or enable OpenGL ES support."
         exit 101
-    fi
-    CFG_EGL=no
 elif [ "$CFG_EGL" != "no" ]; then
     if [ -n "$PKG_CONFIG" ] && $PKG_CONFIG --exists egl 2>/dev/null; then
         QMAKE_INCDIR_EGL=`$PKG_CONFIG --cflags-only-I egl 2>/dev/null | sed -e 's,^-I,,g' -e 's, -I, ,g'`
@@ -5523,7 +5507,7 @@ elif [ "$CFG_EGL" != "no" ]; then
 fi
 
 if [ "$CFG_EGLFS" != "no" ]; then
-    if [ "$CFG_OPENGL" = "es2" ] && [ "$XPLATFORM_QNX" = "no" ]; then
+    if [ "$XPLATFORM_QNX" = "no" ]; then
         CFG_EGLFS="$CFG_EGL"
     else
         CFG_EGLFS="no"
@@ -5531,7 +5515,7 @@ if [ "$CFG_EGLFS" != "no" ]; then
 fi
 
 if [ "$CFG_KMS" = "yes" ]; then
-    if [ "$CFG_OPENGL" = "es2" ] && [ "$CFG_EGL" = "yes" ]; then
+    if [ "$CFG_EGL" = "yes" ]; then
         CFG_KMS="yes"
     else
         CFG_KMS="no"
@@ -5911,11 +5895,7 @@ else
 fi
 
 if [ "$CFG_OPENGL" = "es2" ]; then
-    QCONFIG_FLAGS="$QCONFIG_FLAGS QT_OPENGL_ES"
-fi
-
-if [ "$CFG_OPENGL" = "es2" ]; then
-    QCONFIG_FLAGS="$QCONFIG_FLAGS QT_OPENGL_ES_2"
+    QCONFIG_FLAGS="$QCONFIG_FLAGS QT_OPENGL_ES QT_OPENGL_ES_2"
     QT_CONFIG="$QT_CONFIG opengles2"
 fi
 
-- 
1.8.4.2

